<div class="log-viewer">
  <h1>Log Viewer</h1>

  <!-- Filters -->
  <div class="filters">
    <select [(ngModel)]="filters.applicationId" (change)="search()">
      <option value="">All Applications</option>
      @for (app of applications(); track app.id) {
        <option [value]="app.id">{{ app.name }}</option>
      }
    </select>

    <select [(ngModel)]="filters.minLevel" (change)="search()">
      <option [ngValue]="undefined">All Levels</option>
      <option [ngValue]="0">Trace+</option>
      <option [ngValue]="1">Debug+</option>
      <option [ngValue]="2">Info+</option>
      <option [ngValue]="3">Warning+</option>
      <option [ngValue]="4">Error+</option>
      <option [ngValue]="5">Critical</option>
    </select>

    <input
      type="text"
      [(ngModel)]="filters.searchText"
      placeholder="Search logs..."
      (keyup.enter)="search()"
    />

    <button class="btn" (click)="search()">Search</button>
    <button class="btn btn-secondary" (click)="clearFilters()">Clear</button>
  </div>

  <!-- Loading -->
  @if (loading()) {
    <div class="loading">Loading...</div>
  }

  <!-- Logs Table -->
  <div class="logs-table" [class.loading-overlay]="loading()">
    <table>
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>Level</th>
          <th>Application</th>
          <th>Message</th>
        </tr>
      </thead>
      <tbody>
        @for (log of logs(); track log.id) {
          <tr [class]="'level-' + log.level" (click)="selectLog(log)">
            <td class="timestamp">{{ log.timestamp | date:'short' }}</td>
            <td><span class="level-badge">{{ getLogLevelName(log.level) }}</span></td>
            <td>{{ log.applicationName }}</td>
            <td class="message">{{ log.message }}</td>
          </tr>
        }
        @if (logs().length === 0 && !loading()) {
          <tr>
            <td colspan="4" class="no-data">No logs found</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <button [disabled]="!pagedResponse()?.hasPreviousPage" (click)="goToPage(currentPage() - 1)">
      Previous
    </button>
    <span>Page {{ currentPage() }} of {{ pagedResponse()?.totalPages || 1 }}</span>
    <button [disabled]="!pagedResponse()?.hasNextPage" (click)="goToPage(currentPage() + 1)">
      Next
    </button>
  </div>

  <!-- Log Detail Modal -->
  @if (selectedLog()) {
    <div class="modal-overlay" (click)="selectedLog.set(null)">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Log Details</h3>
          <button class="close-btn" (click)="selectedLog.set(null)">&times;</button>
        </div>
        <div class="modal-body">
          <div class="detail-row">
            <label>ID:</label>
            <span>{{ selectedLog()!.id }}</span>
          </div>
          <div class="detail-row">
            <label>Timestamp:</label>
            <span>{{ selectedLog()!.timestamp | date:'medium' }}</span>
          </div>
          <div class="detail-row">
            <label>Level:</label>
            <span class="level-badge" [class]="'level-' + selectedLog()!.level">
              {{ getLogLevelName(selectedLog()!.level) }}
            </span>
          </div>
          <div class="detail-row">
            <label>Application:</label>
            <span>{{ selectedLog()!.applicationName }}</span>
          </div>
          <div class="detail-row">
            <label>Message:</label>
            <span class="message-full">{{ selectedLog()!.message }}</span>
          </div>
          @if (selectedLog()!.exception) {
            <div class="detail-row">
              <label>Exception:</label>
              <pre>{{ selectedLog()!.exception }}</pre>
            </div>
          }
          @if (selectedLog()!.stackTrace) {
            <div class="detail-row">
              <label>Stack Trace:</label>
              <pre>{{ selectedLog()!.stackTrace }}</pre>
            </div>
          }
          @if (selectedLog()!.properties) {
            <div class="detail-row">
              <label>Properties:</label>
              <pre>{{ selectedLog()!.properties | json }}</pre>
            </div>
          }
          @if (selectedLog()!.correlationId) {
            <div class="detail-row">
              <label>Correlation ID:</label>
              <span>{{ selectedLog()!.correlationId }}</span>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
